# Упражнение 5 - React Router

Проблема маршрутизации начинает появляеться в практически любом React приложении
как только у вас появляються несколько различных экранов между которыми может
переключаться пользователь. На первый взгляд переключение работает, но за годы
использования браузеров у пользователей выработались определенные ожидания. Что
пользователь может вернуться на предыдущую страницу с использование кнопки
"назад" в браузере или что пользователь может сохранить текущую страницу и
открыть ее в другом браузере например на своем мобильном устройстве. Для решения
этих проблем и упрощения работы с переходами между разными URL в приложении и
была создана библиотека React Router. В ее текущей(6ой) версии эта библиотека
делает намного больше чем просто помогает решить изложенные проблемы и мы
коснемся некоторых из ее возможностей подробнее в этом задании.

## Задание

Заменить наш собственный роутинг на react-router и проверить что все работает
как раньше. Для начала нам нужно установить библиотеку

```
npm install react-router-dom@6
```

Далее нам прийдеться достаточно много поменять в нашем приложении, чтобы
подключить роутинг. Сначала мы выделим нашу корзину в отдельный компонент так
как переключение на нее будет осуществляеть React router, а не наше приложение.

```jsx
// в файле App.js
export function BasketPlace() {
  const isLoaded = useSelector((state) => state.isLoaded);
  const error = useSelector((state) => state.error);
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(fetchItemsThunk());
  }, [dispatch]);
  let basketPlace = null;

  if (error) {
    basketPlace = <div>Ошибка: {error.message}</div>;
  } else if (!isLoaded) {
    basketPlace = <div>Загрузка...</div>;
  } else {
    basketPlace = <Basket />;
  }
  return basketPlace;
}
function App() {
  // Весь код до этой строчки перемещен в BasketPlace
  const [currrentPath, setCurrrentPath] = useState("/");
}
```

Выделить этот компонент в отдельный файл.

Вторый шаг это убрать наш ручной роутинг из нашего приложения. Для этого мы
можем удалить switch и состояние котороые относятся к роутингу.

```jsx
// в файле App.js
function App() {
  // весь код до этого можно удалить
  return <div className="App">...</div>;
}
```

Попробуйте открыть приложение в браузере. Теперь мы будем исправлять ошибки:

1. `'clickTopMenuHandler' is not defined` React router будет обрабатывать наши
   переходы по ссылкам с помощью специального компонента `<Link/>` который
   работает примерно по тому же принципу, что и наш компонент `<a/>`. Поэтому мы
   можем просто поменять наши ссылки на `<Link/>` и приложение станет работать
   как надо.

   Меняем:

```jsx
<a href="#" onClick={clickTopMenuHandler} data-route={"/"}>
  Главная
</a>
```

на

```jsx
import { Link } from "react-router-dom";
//...
<Link to={"/"}>Главная</Link>;
```

2. `'title' is not defined` - пока мы заменим title на фиксированный и вернемся
   к нему в доп. задании. Определите `const title = "React router"`

3. `'content is not defined` - вместо content в React Router используется
   специальный компонент `<Outlet>` - этот компонент позволяет определить в
   `Layout` место в котором нужно отображать изменяемый контент потомков. Можно
   смотреть на это как заглушки - `Outlet` ставиться как заглушка на место
   которой впоследствии в зависимости от выбранного пользователям пути
   отрисуется нужный реальный компонент.

```jsx
import { Outlet } from "react-router";
///...
<h1>{title}</h1>
<Outlet />
```

Теперь приложение должно успешно запуститься в браузере. Переходы все еще не
будут работать для этого нам нужно определить маршруты переходов. Для этого в
React Router используется специальный набор компонентов:

- `Browser-Router` - роутер отвечающий за переходы по ссылкам в браузере.
- `Routes` - общий родитель для всех маршрутов.
- `Route` - определяет один маршрут.

Маршруты определяются следующим образом:

```jsx
// index.js
import BasketPlace from "./BasketPlace";
import { BrowserRouter, Routes, Route } from "react-router-dom";

// Мы перенесем нашу основную разметку в отдельную переменную
const appWithRedux = (
  <Provider store={store}>
    <App />
  </Provider>
);

const routes = (
  <BrowserRouter>
    <Routes>
      {/* Главный путь определяет разметку для всего приложения */}
      <Route path="/" element={appWithRedux}>
        {/* Все родительские пути наследуют эту разметку */}
        <Route index element={<div>Тут может быть перечень товаров</div>} />
        <Route path="/basket" element={<BasketPlace />} />
        <Route path="/about" element={<div>информация о компании</div>} />
        <Route
          path="/react-router"
          element={<div>react router is here </div>}
        />
      </Route>
    </Routes>
  </BrowserRouter>
);
//....
root.render(routes);
```

## Доп. задания

1. Вернуть кастомизация title взависимости от страницы на которой находиться
   пользователь - только для страницы с корзиной - главной

В этом вам поможет
[`useOutletContext`](https://reactrouter.com/docs/en/v6/hooks/use-outlet-context)
который позволяет определить состояние доп. контекст доступный в потомках.
Например:

```jsx
function Parent() {
  const [count, setCount] = React.useState(0);
  return <Outlet context={[count, setCount]} />;
}

function Child() {
  const { setCount } = useOutletContext();
  // это установит счетчик в родительском компоненте в новое значение
  setCount(1);
}
```

Также обратите внимание, что вам придеться сделать путь главной страницы
`Тут может быть перечень товаров` в отдельный компонент, чтобы использовать
функцию `useOutletContext`

2. Добавить в путь о рутинге параметры и вывести их на страницу.

Для добавления параметров в React router используется следующий синтакс в
определении пути:

```jsx
path = "invoices/:invoiceId";
```

Чтобы получить доступ к этим параметрам используется хук `useParams`:

```jsx
let params = useParams();
params.invoiceId;
```

В вашем примере дайте возможность пользователю ввести имя и попривествуйте его
на страницы в соотвествии с введеным именем. Обратите, внимание что у вас
перестанет работать путь без параметров после добавления параметра. Для
исправления этого вам понадобиться использовать index route:

```jsx
<Route path="/invoices/">
  <Route index element={<InvoicesList />} />
  <Route path=":invoiceId" element={<Invoice />} />
</Route>
```

## Файлы

- src/App.js
- src/index.js

```

```

```

```
